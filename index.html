<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Reptile Map</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
         integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
         crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
         integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
         crossorigin=""></script>

    <style>
        
        #map { height: 400px; }

        body {    
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Light grey background */
        }

        /* Custom styles for a subtle shadow and rounded corners on cards */
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem; /* rounded-xl */
        }

        /* Hero section background with a subtle gradient */
        .hero-bg {
            background: linear-gradient(to right, #4CAF50, #8BC34A); /* Green gradient */
        }

    </style>

</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <!-- Logo/Site Title -->
            <a href="#" class="text-3xl font-bold text-emerald-700 mb-4 md:mb-0 rounded-lg p-2 hover:bg-emerald-50 transition duration-300">
                The Reptile Map
            </a>

            <!-- Navigation -->
            <nav>
                <ul class="flex flex-wrap justify-center space-x-4 md:space-x-6 text-lg">
                    <li><a href="#about" class="text-gray-700 hover:text-emerald-600 font-medium transition duration-300 p-2 rounded-md hover:bg-gray-100">About Us</a></li>
                    <li><a href="#map" class="text-gray-700 hover:text-emerald-600 font-medium transition duration-300 p-2 rounded-md hover:bg-gray-100">Map</a></li>
                    <li><a href="#projects" class="text-gray-700 hover:text-emerald-600 font-medium transition duration-300 p-2 rounded-md hover:bg-gray-100">Projects</a></li>
                    <li><a href="#stories" class="text-gray-700 hover:text-emerald-600 font-medium transition duration-300 p-2 rounded-md hover:bg-gray-100">Stories</a></li>
                    <li><a href="#events" class="text-gray-700 hover:text-emerald-600 font-medium transition duration-300 p-2 rounded-md hover:bg-gray-100">Events</a></li>
                    <li><a href="#contact" class="text-gray-700 hover:text-emerald-600 font-medium transition duration-300 p-2 rounded-md hover:bg-gray-100">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-bg text-white py-20 px-4 text-center rounded-b-xl mx-auto max-w-7xl mt-4 card">
        <div class="container mx-auto">
            <h1 class="text-5xl md:text-6xl font-extrabold mb-6 leading-tight">
                Mapping the World's Reptiles
            </h1>
            <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto">
                A global initiative to understand reptile biogeography, monitor populations, and inform conservation strategies.
            </p>
            <a href="#about" class="bg-white text-emerald-700 hover:bg-emerald-100 font-bold py-3 px-8 rounded-full text-lg transition duration-300 transform hover:scale-105 inline-block">
                Learn More
            </a>
        </div>
    </section>

    <!-- About Us Section -->
    <section id="about" class="py-16 px-4 bg-white rounded-xl mx-auto max-w-7xl mt-8 card">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-emerald-800 mb-8">About Us</h2>
            <p class="text-lg leading-relaxed max-w-4xl mx-auto mb-6">
                The Reptile Map is dedicated to creating a comprehensive, interactive, and accessible global mapping platform that documents the distribution and diversity of reptile species around the world. We aim to establish a global network of citizen scientists and researchers to gather crucial data.
            </p>
            <p class="text-lg leading-relaxed max-w-4xl mx-auto">
                Our mission is to be a valuable resource for understanding reptile biogeography, monitoring population trends, identifying conservation hotspots, and informing strategies for the protection and management of reptiles and their habitats.
            </p>
        </div>
    </section>

    <!-- Map Section (Simplified Placeholder) -->
    <section id="map" class="rounded-xl mx-auto max-w-7xl mt-8 card">
        <div id="map"></div>
    </section>

    <section id="obs" class="py-16 px-4 bg-gray-100 rounded-xl mx-auto max-w-7xl mt-8 card">

            <!-- here is the form -->
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Submit Observation</h2>

        <form id="observationForm" class="space-y-4">
            
            <div>
                <label for="latitude" class="block text-sm font-medium text-gray-700 mb-1">Latitude:</label>
                <input type="number" id="latitude" name="latitude" step="any" placeholder="e.g., 34.0522"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                       required>
            </div>

            <div>
                <label for="longitude" class="block text-sm font-medium text-gray-700 mb-1">Longitude:</label>
                <input type="number" id="longitude" name="longitude" step="any" placeholder="e.g., -118.2437"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                       required>
            </div>

            <div>
                <label for="species" class="block text-sm font-medium text-gray-700 mb-1">Species:</label>
                <input type="text" id="species" name="species" placeholder="e.g., American Alligator"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                       required>
            </div>

            <div>
                <label for="link" class="block text-sm font-medium text-gray-700 mb-1">Link (URL):</label>
                <input type="url" id="link" name="link" placeholder="e.g., https://example.com/observation"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>

            <div>
                <label for="image" class="block text-sm font-medium text-gray-700 mb-1">Image (URL):</label>
                <input type="url" id="image" name="image" placeholder="e.g., https://ibb.co/gZPZTx1j"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>

            <button id='submit' type="submit"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Submit
            </button>

        </form>

        <!-- here is the confirmation area -->
        <p class="mt-6 text-md text-gray-600">
            <div id="messageBox"></div>
        </p>

    </section>

    <!-- Projects Section (Placeholder) -->
    <section id="projects" class="py-16 px-4 bg-white rounded-xl mx-auto max-w-7xl mt-8 card">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-emerald-800 mb-8">Our Projects</h2>
            <p class="text-lg leading-relaxed max-w-4xl mx-auto mb-8">
                We are involved in various projects aimed at reptile research, habitat restoration, and community engagement. From tracking endangered species to educating local communities, our work spans the globe.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Project Card 1 -->
                <div class="bg-emerald-50 p-6 rounded-xl card">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-4">Species Monitoring</h3>
                    <p class="text-gray-700">Implementing advanced tracking and monitoring programs for vulnerable reptile populations across diverse ecosystems.</p>
                </div>
                <!-- Project Card 2 -->
                <div class="bg-emerald-50 p-6 rounded-xl card">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-4">Habitat Restoration</h3>
                    <p class="text-gray-700">Working to restore critical reptile habitats, ensuring safe and thriving environments for various species.</p>
                </div>
                <!-- Project Card 3 -->
                <div class="bg-emerald-50 p-6 rounded-xl card">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-4">Citizen Science</h3>
                    <p class="text-gray-700">Engaging the public in data collection efforts, transforming everyday citizens into vital contributors to conservation.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Stories Section -->
    <section id="stories" class="py-16 px-4 bg-gray-100 rounded-xl mx-auto max-w-7xl mt-8 card">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-emerald-800 mb-8">Latest Stories</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Story Card 1 -->
                <div class="bg-white p-6 rounded-xl card">
                    <img src="https://placehold.co/400x250/d1fae5/065f46?text=Climate+Change" alt="Climate Change" class="w-full h-48 object-cover rounded-lg mb-4">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-2">Climate Change and Its Impact on Florida's Reptiles</h3>
                    <p class="text-gray-700 text-sm mb-4">Learn how changing weather patterns are affecting the unique reptile species of Florida.</p>
                    <a href="#" class="text-emerald-600 hover:text-emerald-800 font-medium">Read More &rarr;</a>
                </div>
                <!-- Story Card 2 -->
                <div class="bg-white p-6 rounded-xl card">
                    <img src="https://placehold.co/400x250/d1fae5/065f46?text=Nature+in+Winter" alt="Nature in Winter" class="w-full h-48 object-cover rounded-lg mb-4">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-2">Nature in Winter: Reptile Hibernation</h3>
                    <p class="text-gray-700 text-sm mb-4">Discover the fascinating ways reptiles adapt and survive during the colder months.</p>
                    <a href="#" class="text-emerald-600 hover:text-emerald-800 font-medium">Read More &rarr;</a>
                </div>
                <!-- Story Card 3 -->
                <div class="bg-white p-6 rounded-xl card">
                    <img src="https://placehold.co/400x250/d1fae5/065f46?text=Lizards+Culture" alt="Lizards in Culture" class="w-full h-48 object-cover rounded-lg mb-4">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-2">Lizards in Southwest Native American Culture</h3>
                    <p class="text-gray-700 text-sm mb-4">Explore the rich symbolism and importance of lizards in indigenous cultures of the Southwest.</p>
                    <a href="#" class="text-emerald-600 hover:text-emerald-800 font-medium">Read More &rarr;</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Events Section (Placeholder) -->
    <section id="events" class="py-16 px-4 bg-white rounded-xl mx-auto max-w-7xl mt-8 card">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-emerald-800 mb-8">Upcoming Events</h2>
            <p class="text-lg leading-relaxed max-w-4xl mx-auto mb-8">
                Join us for our upcoming workshops, webinars, and field trips designed to educate and engage reptile enthusiasts and conservationists.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Event Card 1 -->
                <div class="bg-emerald-50 p-6 rounded-xl card text-left">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-2">Reptile Identification Workshop</h3>
                    <p class="text-gray-700 mb-2">Date: October 26, 2025</p>
                    <p class="text-gray-700 mb-4">Location: Online Webinar</p>
                    <p class="text-gray-700">Learn to identify common reptile species in your region with expert guidance.</p>
                </div>
                <!-- Event Card 2 -->
                <div class="bg-emerald-50 p-6 rounded-xl card text-left">
                    <h3 class="text-2xl font-semibold text-emerald-700 mb-2">Habitat Restoration Day</h3>
                    <p class="text-gray-700 mb-2">Date: November 15, 2025</p>
                    <p class="text-gray-700 mb-4">Location: Local Nature Reserve</p>
                    <p class="text-gray-700">Volunteer to help restore critical habitats for local reptile populations.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-16 px-4 bg-gray-100 rounded-xl mx-auto max-w-7xl mt-8 card">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold text-emerald-800 mb-8">Contact Us</h2>
            <p class="text-lg leading-relaxed max-w-2xl mx-auto mb-8">
                Have questions, suggestions, or want to get involved? Reach out to us!
            </p>
            <form class="max-w-xl mx-auto bg-white p-8 rounded-xl card">
                <div class="mb-6 text-left">
                    <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Name:</label>
                    <input type="text" id="name" name="name" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Your Name">
                </div>
                <div class="mb-6 text-left">
                    <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                    <input type="email" id="email" name="email" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="your.email@example.com">
                </div>
                <div class="mb-6 text-left">
                    <label for="message" class="block text-gray-700 text-sm font-bold mb-2">Message:</label>
                    <textarea id="message" name="message" rows="6" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Your message..."></textarea>
                </div>
                <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-full text-lg transition duration-300 transform hover:scale-105">
                    Send Message
                </button>
            </form>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-emerald-800 text-white py-8 mt-12 rounded-t-xl">
        <div class="container mx-auto text-center">
            <p class="text-lg mb-4">&copy; 2025 The Reptile Map. All rights reserved.</p>
            <div class="flex justify-center space-x-6">
                <a href="#" class="text-white hover:text-emerald-300 transition duration-300">Privacy Policy</a>
                <a href="#" class="text-white hover:text-emerald-300 transition duration-300">Terms of Service</a>
            </div>
        </div>
    </footer>

</body>

    <script>

        // create function to get data from Google Sheet
        async function fetchGoogleSheetCsv(url) {
            try {
                const response = await fetch(url);

                // Check if the network request was successful (status code 200-299)
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status} - Could not fetch data from ${url}`);
                }

                // Get the response body as plain text
                const csvText = await response.text();

                // Split the text into individual lines and trim whitespace from each line
                // .filter(line => line.trim() !== '') ensures empty lines are not included
                const lines = csvText.trim().split('\n').filter(line => line.trim() !== '');

                return lines;

            } catch (error) {
                console.error("Error fetching Google Sheet CSV data:", error);
                // Re-throw the error so the calling function can handle it
                throw error;
            }
        } // end function


        // Google sheet sharing as CSV URL
        const exampleGoogleSheetCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR0CabXJ0prVhGGccFuidPRCP0YNj1Pv2xKEXgpCF9LTitRnEdDB_VlQXyJGnD-v1xeKEqMGkcpTQiR/pub?gid=0&single=true&output=csv';


        (async () => {
            try {
                const dataLines = await fetchGoogleSheetCsv(exampleGoogleSheetCsvUrl);
                console.log("Fetched data lines:", dataLines);

                // Example: Parse headers and first data row
                if (dataLines.length > 1) {
                    const headers = dataLines[0].split(',').map(h => h.trim());
                    const firstDataRow = dataLines[1].split(',').map(d => d.trim());

                    /* DO MAP STUFF */
                    var lat = firstDataRow[0];
                    var lon = firstDataRow[1];

                    var map = L.map('map').setView([lat, lon], 13);
                    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                        }).addTo(map);

                        for (i=1;i<dataLines.length;i++) {
                            row = dataLines[i].split(',').map(d => d.trim());
                            var lat = row[0];
                            var lon = row[1];
                            var species = row[2];
                            var marker = L.marker([lat, lon]).addTo(map);
                            marker.bindPopup("<h3>" + species + "</h3>").openPopup();
                        }

                        //var marker = L.marker([lat, lon]).addTo(map);

                        map.on('click', function(e) {
                            var lat = e.latlng.lat; 
                            var lng = e.latlng.lng;

                            console.log(lat,lng);
                            document.getElementById("latitude").value = lat;
                            document.getElementById("longitude").value = lng;

                            L.popup()
                                .setLatLng(e.latlng)
                                .setContent("Clicked at: " + e.latlng.toString())
                                .openOn(map);
                        });

                } else {
                    console.log("No data rows found after headers.");
                }
            
            } catch (error) {
                console.error("Failed to process Google Sheet data:", error);
            }
        })();

        // Upload data to Google Sheet using Google Apps script
        var form = document.getElementById('observationForm');
        
        // add a listener to submit click button
        form.addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const latitude = document.getElementById('latitude').value;
            const longitude = document.getElementById('longitude').value;
            const species = document.getElementById('species').value;
            const link = document.getElementById('link').value;
            const image = document.getElementById('image').value;

            const messageBox = document.getElementById('messageBox');
            messageBox.style.display = 'block';
            messageBox.className = 'message-box'; // Reset classes
            messageBox.innerHTML = 'Submitting data...';

            const formData = {
                latitude: latitude,
                longitude: longitude,
                species: species,
                link: link,
                image: image
            };

            console.log('Form Data to be sent:', formData);

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbzXGg7JBAT3tzZs2H8Mf7I69Z9QXcqaLeWxfuwfmbgRmW-NZkU1CHa4SKbgXJPAbn7LMA/exec', {
                    method: 'POST',
                    mode: 'no-cors', // Required for cross-origin requests to Apps Script
                    headers: {
                    'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                messageBox.classList.add('success');
                messageBox.innerHTML = 'Data successfully submitted!';
                document.getElementById('observationForm').reset();
            } catch (error) {
                console.error('Error:', error);
                messageBox.classList.add('error');
                messageBox.innerHTML = 'Error submitting data. Please try again.';
            }
        });

    </script>

</html>
